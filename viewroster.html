<!DOCTYPE html>
<html>

<head>
<!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="initial-scale=1, shrink-to-fit=no, width=device-width" name="viewport">

    <!-- CSS -->
    <!-- Add Material font (Roboto) and Material icon as needed -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i|Roboto+Mono:300,400,700|Roboto+Slab:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Add Material CSS, replace Bootstrap CSS -->
    <link href="material/css/material.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script type="text/javascript" src="lib/axios/dist/axios.standalone.js"></script>
    <script type="text/javascript" src="lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script type="text/javascript" src="lib/CryptoJS/rollups/sha256.js"></script>
    <script type="text/javascript" src="lib/CryptoJS/components/hmac.js"></script>
    <script type="text/javascript" src="lib/CryptoJS/components/enc-base64.js"></script>
    <script type="text/javascript" src="lib/url-template/url-template.js"></script>
    <script type="text/javascript" src="lib/apiGatewayCore/sigV4Client.js"></script>
    <script type="text/javascript" src="lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script type="text/javascript" src="lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script type="text/javascript" src="lib/apiGatewayCore/utils.js"></script>
    <script type="text/javascript" src="apigClient.js"></script>
    <script src="js/amazon-cognito-auth.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script src="js/amazon-cognito-identity.min.js"></script>
    <script src="dist/amazon-cognito-auth.min.js"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">

</head>

<body onload="onLoad()">
<div class="container" style="padding: 5%">
    <div class="row">
        <div class="col-1"></div>
                <div class="col-10">
            <div>
                <h1 class="display-4" style="display: block">Team Roster </h1>
            </div>
            <hr>
            <div id="RosterTable">
                <table id="rosterTable" class="table table-hover">
              <thead>
                
                <tr id="dayRow">
                  <th scope="col">Week-Day</th>
                  <th scope="col" id="sun" style="text-align: center;">Sunday</th>
                  <th scope="col" id="mon" style="text-align: center;">Monday</th>
                  <th scope="col" id="tue" style="text-align: center;">Tuesday</th>
                  <th scope="col" id="wed" style="text-align: center;">Wednesday</th>
                  <th scope="col" id="thur" style="text-align: center;">Thursday</th>
                  <th scope="col" id="fri" style="text-align: center;">Friday</th>
                  <th scope="col" id="sat" style="text-align: center;">Saturday</th>
                </tr>

                <tr id="dateRow">
                 <th scope="row">Date</th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                 <th scope='col' style='text-align: center;'></th>
                </tr>
              </thead>
              <tbody id="IndivUserRow">
              </tbody>
            </div>
            </table>
            <hr>
          <div style="float: right;">
              <button id="nw" style="width: 150px">Next Week</button>
          </div>
          <div style="float: left;">
              <button id="pw" style="width: 150px">Previous Week</button>
          </div>
            </div>
        </div>
        <div class="col-1"></div>

    <script type="text/javascript">

      document.getElementById("sun").innerHTML += "1";
     
    AWS.config.apiVersions = {
      cognitoidentityserviceprovider: '2016-04-18',
    };
    AWS.config.update({
        region: 'eu-west-1'
    });
    AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: 'eu-west-1:08ef8fa8-18f8-4f87-ad0f-d67cc25b28fb'});

    var lambda = new AWS.Lambda({region: 'eu-west-1', apiVersion: '2015-03-31'});
    var pullParams = {
      FunctionName : 'list-userpool-users',
      InvocationType : 'RequestResponse',
      LogType : 'None'
    };
    // create variable to hold data returned by the Lambda function
    lambda.invoke(pullParams, function(error, data) {
      if (error) {
        console.log(error);
      } else {
        pullResults = JSON.parse(JSON.parse(data.Payload));
        //console.log(pullResults)
        var userIdentity = pullResults.Users
        var uname = userIdentity
        for(var i = 0; i < userIdentity.length; i++){
          var IndivUser = userIdentity[i]['Attributes'][2]['Value']
          userName = JSON.parse(IndivUser)
          Nname = userName[0]['userId']
          var IndivUserShift = userIdentity[i]['Attributes'][6]['Value']
          if(IndivUserShift == "Mon-Fri"){
            document.getElementById('IndivUserRow').innerHTML += "<tr>\
                  <th scope='row'>"+Nname+"</th>\
                  <td bgcolor='FFFF00'>OFF</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='FFFF00'>OFF</td></tr>";          
                }else if(IndivUserShift == "Tue-Sat"){
            document.getElementById('IndivUserRow').innerHTML += "<tr>\
                  <th scope='row'>"+Nname+"</th>\
                  <td bgcolor='FFFF00'>OFF</td>\
                  <td bgcolor='FFFF00'>OFF</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td></tr>";            
          }     else if(IndivUserShift == "Sun-Thurs"){
                   document.getElementById('IndivUserRow').innerHTML += "<tr>\
                  <th scope='row'>"+Nname+"</th>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='00FF00'>IN</td>\
                  <td bgcolor='FFFF00'>OFF</td>\
                  <td bgcolor='FFFF00'>OFF</td></tr>"; 
          }            
      
        }

      }
    })

    var cognitoidentityserviceprovider = new AWS.CognitoIdentityServiceProvider();
    var accessTk = initCognitoSDK();
    var accessToken = accessTk.signInUserSession['accessToken']['jwtToken'];
    //console.log(accessToken)

    function onLoad() {
        var auth = initCognitoSDK();
        var curUrl = window.location.href;
        auth.parseCognitoWebResponse(curUrl);
        //console.log(auth)
    }

    // Initialize a cognito auth object.
    function initCognitoSDK() {
        var authData = {
            ClientId : 'nfm3pqn7899pnc4mkomangdeb', 
            AppWebDomain : 'rollcall.auth.eu-west-1.amazoncognito.com',  
            TokenScopesArray : ['openid', 'email', 'phone', 'profile', 'aws.cognito.signin.user.admin'],
            RedirectUriSignIn : 'https://dev-rollcall.corp.amazon.com/newui.html',
            RedirectUriSignOut : 'https://inside.amazon.com/',
            IdentityProvider : 'Midway', 
            UserPoolId : 'eu-west-1_i0HfJ8ilR'
        };
        
        var auth = new AmazonCognitoIdentity.CognitoAuth(authData);
        auth.userhandler = {
            onSuccess: function(result) {
            },
            onFailure: function(err) {
                alert("Error!" + err);
            }
        };
        auth.useCodeGrantFlow();
        return auth;
    }

      function addDate(){
        initWeek();
        window.currentWeek = populateWeek(window.currentWeek);
      }

      addDate();

      function initWeek(){
        if(window.currentWeek == null){
          window.currentWeek = new Date();
          window.currentWeek.setDate(window.currentWeek.getDate() - window.currentWeek.getDay() - 1);
        }
      }

      function getDateLabel(date){
        const month = date.toLocaleString('en-us', { month: 'long' });
        return date.getDate() + " " + month.substring(0,3);
      }

      function populateWeek(date){
        els = document.getElementById("dateRow").getElementsByTagName('th');
        for (var i = 1; i < els.length; i++) {
          date.setDate( date.getDate() + 1 );
          els[i].innerHTML = getDateLabel(date);
        }
        return date;
      }

    function movePreviousWeek(){
      var date = window.currentWeek;
      date.setDate(date.getDate() - 14);
      window.currentWeek  = populateWeek(date);
    }
    function moveNextWeek(){ 
      console.log("clicking next")
      window.currentWeek  = populateWeek(window.currentWeek);
    }

    document.getElementById("nw").addEventListener("click", moveNextWeek);
    function goingPreviousWeek(){ 
      console.log("clicking prev")
    }
    
    document.getElementById("pw").addEventListener("click", movePreviousWeek);



    </script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

    <!-- Then Material JavaScript on top of Bootstrap JavaScript -->
    <script src="material/js/material.min.js"></script>
</body>

</html>
